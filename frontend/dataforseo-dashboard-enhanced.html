<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered DataForSEO Dashboard - Digital Marketing Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .input-group {
            display: flex;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .input-group input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .main-content {
            padding: 30px;
        }

        .welcome-section {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .welcome-section h2 {
            color: #667eea;
            font-size: 2.2em;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .welcome-section p {
            color: #6c757d;
            font-size: 1.1em;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-card p {
            color: #6c757d;
            line-height: 1.5;
        }

        .analysis-results {
            display: none;
        }

        .overview-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            text-align: center;
        }

        .overview-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2em;
            font-weight: bold;
            color: white;
        }

        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e83e8c); }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }

        .section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .ai-chat-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ai-chat-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .ai-recommendations {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border: 1px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .ai-recommendations.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-recommendations h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-recommendations h4::before {
            content: '🤖';
            font-size: 1.1em;
        }

        .recommendations-content {
            white-space: pre-line;
            line-height: 1.6;
            color: #495057;
            font-size: 14px;
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #667eea;
            font-style: italic;
        }

        .ai-loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #495057;
        }

        .metric-value {
            font-weight: 600;
            color: #667eea;
        }

        .keyword-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .keyword-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .keyword-text {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .keyword-stats {
            font-size: 0.9em;
            color: #6c757d;
        }

        .competitor-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .competitor-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #dee2e6;
        }

        .competitor-domain {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .competitor-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .stat-label {
            font-size: 0.8em;
            color: #6c757d;
            margin-bottom: 2px;
        }

        .stat-value {
            font-weight: 600;
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading::before {
            content: '';
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .restricted-access-notice {
            background: #e2e3e5;
            color: #495057;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
            text-align: center;
        }

        .restricted-access-notice .notice-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .restricted-access-notice h3 {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .restricted-access-notice p {
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.6;
        }

        .restricted-access-notice .notice-details {
            text-align: left;
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .restricted-access-notice .notice-details strong {
            color: #495057;
            display: block;
            margin-bottom: 10px;
            margin-top: 15px;
        }

        .restricted-access-notice .notice-details ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .restricted-access-notice .notice-details li {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        .upgrade-notice {
            background: #fff3cd;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
            text-align: center;
            font-weight: 500;
        }

        .upgrade-notice small {
            color: #6c757d;
            font-weight: 400;
        }

        .content-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .content-section h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .services-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .service-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .projects-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .project-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .project-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
        }

        .project-desc {
            color: #6c757d;
            font-size: 14px;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contact-item {
            color: #495057;
            font-size: 14px;
        }

        .success-notice {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
            font-weight: 500;
        }

        .keyword-tag {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin: 2px;
            display: inline-block;
        }

        .keywords-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .competitors-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .competitor-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .competitor-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .competitor-desc {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .competitor-position {
            color: #28a745;
            font-size: 12px;
            font-weight: 500;
        }

        /* SEO Recommendations Styles */
        .recommendations-section {
            margin-bottom: 20px;
        }

        .recommendations-section h5 {
            margin: 0 0 15px 0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
        }

        .critical-title {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .important-title {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .suggestions-title {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .recommendation-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .recommendation-item.critical {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }

        .recommendation-item.important {
            border-left: 4px solid #ffc107;
            background: #fffbf0;
        }

        .recommendation-item.suggestion {
            border-left: 4px solid #17a2b8;
            background: #f0f9ff;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .impact-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .impact-badge.critical {
            background: #dc3545;
            color: white;
        }

        .impact-badge.important {
            background: #ffc107;
            color: #212529;
        }

        .impact-badge.suggestion {
            background: #17a2b8;
            color: white;
        }

        .rec-recommendation {
            color: #495057;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .rec-example, .rec-current, .rec-action {
            font-size: 14px;
            margin-bottom: 5px;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(255,255,255,0.7);
        }

        .rec-example {
            border-left: 3px solid #28a745;
        }

        .rec-current {
            border-left: 3px solid #6c757d;
        }

        .rec-action {
            border-left: 3px solid #007bff;
            font-weight: 500;
        }

        /* AI Recommendations Styles */
        .ai-recommendations {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            display: none;
        }

        .ai-recommendations.show {
            display: block;
        }

        .ai-loading {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            font-weight: 500;
        }

        .ai-recommendations-content h4 {
            margin: 0 0 20px 0;
            font-size: 20px;
            color: white;
            text-align: center;
        }

        .ai-recommendation-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .ai-impact-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .ai-impact-badge.critical {
            background: #ff4757;
            color: white;
        }

        .ai-impact-badge.important {
            background: #ffa502;
            color: white;
        }

        .ai-impact-badge.suggestion {
            background: #2ed573;
            color: white;
        }

        .ai-rec-text {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .ai-rec-action, .ai-rec-example {
            font-size: 14px;
            margin-bottom: 5px;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
        }

        .ai-rec-example {
            border-left: 3px solid #2ed573;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .overview-section {
                grid-template-columns: 1fr;
            }
            
            .section h3 {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI-Powered SEO Analysis</h1>
            <p>Get intelligent recommendations powered by ChatGPT and DataForSEO</p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <input type="text" id="websiteUrl" placeholder="Enter website URL (e.g., google.com or https://google.com)" />
                <button class="btn" id="analyzeBtn">🔍 Analyze with AI</button>
            </div>
        </div>

        <div class="main-content">
            <div class="welcome-section" id="welcomeSection">
                <h2>🚀 Welcome to AI-Powered SEO Analysis</h2>
                <p>Our advanced AI system analyzes your website using DataForSEO data and provides intelligent, actionable recommendations powered by ChatGPT. Get personalized SEO strategies tailored to your specific needs.</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">📊</div>
                        <h3>On-Page SEO Analysis</h3>
                        <p>AI-powered recommendations for title tags, meta descriptions, headings, and content optimization.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🎯</div>
                        <h3>Keyword Intelligence</h3>
                        <p>Strategic keyword analysis with AI-generated content ideas and ranking optimization strategies.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🏆</div>
                        <h3>Competitive Analysis</h3>
                        <p>AI-driven competitor insights with actionable strategies to gain competitive advantage.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🔗</div>
                        <h3>Link Building Strategy</h3>
                        <p>Intelligent backlink analysis with AI recommendations for quality link acquisition.</p>
                    </div>
                </div>
            </div>

            <div class="analysis-results" id="analysisResults">
                <!-- Overview Section -->
                <div class="overview-section">
                    <div class="overview-card">
                        <h3>Overall SEO Score</h3>
                        <div class="score-circle" id="overallScore">-</div>
                        <p id="scoreDescription">Analysis in progress...</p>
                    </div>
                    <div class="overview-card">
                        <h3>Performance Metrics</h3>
                        <div class="metric-item">
                            <span class="metric-label">Page Load Time</span>
                            <span class="metric-value" id="loadTime">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Total Keywords</span>
                            <span class="metric-value" id="totalKeywords">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Backlinks</span>
                            <span class="metric-value" id="totalBacklinks">-</span>
                        </div>
                    </div>
                    <div class="overview-card">
                        <h3>Technical Health</h3>
                        <div class="metric-item">
                            <span class="metric-label">Mobile Friendly</span>
                            <span class="metric-value" id="mobileFriendly">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">SSL Certificate</span>
                            <span class="metric-value" id="sslStatus">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Schema Markup</span>
                            <span class="metric-value" id="schemaStatus">-</span>
                        </div>
                    </div>
                </div>

                <!-- On-Page SEO Section -->
                <div class="section">
                    <h3>
                        📊 On-Page SEO Analysis
                        <button class="ai-chat-toggle" onclick="toggleAIRecommendations('onpage')">
                            🤖 Get AI Recommendations
                        </button>
                    </h3>
                    <div id="onpageContent">
                        <div class="loading">Analyzing on-page elements...</div>
                    </div>
                    <div class="ai-recommendations" id="onpageAI">
                        <h4>AI-Powered On-Page Recommendations</h4>
                        <div class="ai-loading">🤖 AI is analyzing your on-page SEO...</div>
                    </div>
                </div>

                <!-- Keywords Section -->
                <div class="section">
                    <h3>
                        🎯 Keyword Analysis
                        <button class="ai-chat-toggle" onclick="toggleAIRecommendations('keywords')">
                            🤖 Get AI Strategy
                        </button>
                    </h3>
                    <div id="keywordsContent">
                        <div class="loading">Analyzing keyword performance...</div>
                    </div>
                    <div class="ai-recommendations" id="keywordsAI">
                        <h4>AI-Powered Keyword Strategy</h4>
                        <div class="ai-loading">🤖 AI is developing your keyword strategy...</div>
                    </div>
                </div>

                <!-- Competitors Section -->
                <div class="section">
                    <h3>
                        🏆 Competitive Analysis
                        <button class="ai-chat-toggle" onclick="toggleAIRecommendations('competitors')">
                            🤖 Get AI Insights
                        </button>
                    </h3>
                    <div id="competitorsContent">
                        <div class="loading">Analyzing competitors...</div>
                    </div>
                    <div class="ai-recommendations" id="competitorsAI">
                        <h4>AI-Powered Competitive Strategy</h4>
                        <div class="ai-loading">🤖 AI is analyzing your competitive landscape...</div>
                    </div>
                </div>

                <!-- Backlinks Section -->
                <div class="section">
                    <h3>
                        🔗 Backlink Analysis
                        <button class="ai-chat-toggle" onclick="toggleAIRecommendations('backlinks')">
                            🤖 Get AI Strategy
                        </button>
                    </h3>
                    <div id="backlinksContent">
                        <div class="loading">Analyzing backlink profile...</div>
                    </div>
                    <div class="ai-recommendations" id="backlinksAI">
                        <h4>AI-Powered Link Building Strategy</h4>
                        <div class="ai-loading">🤖 AI is developing your link building strategy...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentAnalysis = null;

        // Check for URL parameter on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const url = urlParams.get('url');
            
            if (url) {
                // Check if we have existing analysis data from dashboard
                const storedData = localStorage.getItem('dashboardAnalysisData');
                if (storedData) {
                    try {
                        const data = JSON.parse(storedData);
                        if (data.domain === url) {
                            // Use existing analysis data
                            document.getElementById('websiteUrl').value = url;
                            currentAnalysis = data.analysis;
                            displayAnalysis(data.analysis);
                            // Clear the stored data
                            localStorage.removeItem('dashboardAnalysisData');
                            return;
                        }
                    } catch (e) {
                        console.log('Error parsing stored analysis data:', e);
                    }
                }
                
                // Auto-fill the input and start analysis
                document.getElementById('websiteUrl').value = url;
                analyzeWebsite();
            }
        });

        document.getElementById('analyzeBtn').addEventListener('click', analyzeWebsite);
        document.getElementById('websiteUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeWebsite();
            }
        });

        async function analyzeWebsite() {
            const url = document.getElementById('websiteUrl').value.trim();
            if (!url) {
                alert('Please enter a website URL');
                return;
            }

            // Process URL
            let processedUrl = url;
            if (!processedUrl.match(/^https?:\/\//)) {
                processedUrl = 'https://' + processedUrl;
            }

            // Show loading state
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').textContent = '🔍 Analyzing...';

            try {
                const response = await fetch('/api/dataforseo/environment/analyze-website', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: processedUrl })
                });

                const result = await response.json();
                
                if (result.success) {
                    currentAnalysis = result.analysis;
                    displayAnalysis(result.analysis);
                } else {
                    showError(result.error || 'Analysis failed');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Failed to analyze website. Please try again.');
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('analyzeBtn').textContent = '🔍 Analyze with AI';
            }
        }

        function displayAnalysis(analysis) {
            // Update overview
            document.getElementById('overallScore').textContent = analysis.score || 'N/A';
            document.getElementById('overallScore').className = 'score-circle ' + getScoreClass(analysis.score);
            document.getElementById('scoreDescription').textContent = getScoreDescription(analysis.score);
            
            // Update metrics
            document.getElementById('loadTime').textContent = analysis.onPage?.performance?.loadTime || 'Unknown';
            document.getElementById('totalKeywords').textContent = analysis.keywords?.status === 'requires_upgrade' ? 'Upgrade Required' : (analysis.keywords?.totalKeywords || 'N/A');
            document.getElementById('totalBacklinks').textContent = analysis.backlinks?.status === 'requires_upgrade' ? 'Upgrade Required' : (analysis.backlinks?.totalBacklinks || 'N/A');
            
            // Update technical health
            document.getElementById('mobileFriendly').textContent = analysis.onPage?.technical?.mobileFriendly ? '✅ Yes' : '❌ No';
            document.getElementById('sslStatus').textContent = analysis.onPage?.technical?.sslCertificate ? '✅ Secure' : '❌ Not Secure';
            document.getElementById('schemaStatus').textContent = '❌ Missing'; // DataForSEO doesn't provide schema data in on-page analysis

            // Display detailed sections
            displayOnPageAnalysis(analysis.onPage);
            displayKeywordsAnalysis(analysis.keywords);
            displayCompetitorsAnalysis(analysis.competitors);
            displayBacklinksAnalysis(analysis.backlinks);
        }

        function displayOnPageAnalysis(onPageData) {
            const content = document.getElementById('onpageContent');
            
            if (!onPageData) {
                content.innerHTML = '<div class="error">On-page analysis data not available</div>';
                return;
            }

            // Check for restricted access
            if (onPageData.restricted_access) {
                content.innerHTML = `
                    <div class="restricted-access-notice">
                        <div class="notice-icon">🚫</div>
                        <h3>Website Access Restricted</h3>
                        <p>This website has restricted access via robots.txt or security measures, preventing comprehensive SEO analysis.</p>
                        <div class="notice-details">
                            <strong>What this means:</strong>
                            <ul>
                                <li>The website's robots.txt file blocks automated crawlers</li>
                                <li>Security measures prevent external analysis tools</li>
                                <li>Limited SEO data can be gathered</li>
                            </ul>
                            <strong>Recommendations:</strong>
                            <ul>
                                <li>Contact the website owner to request access</li>
                                <li>Use manual SEO audit tools</li>
                                <li>Focus on publicly available information</li>
                            </ul>
                        </div>
                    </div>
                `;
                return;
            }

            let html = '<div class="metric-item"><span class="metric-label">Title Tag</span><span class="metric-value">' + (onPageData.title || 'Missing') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Meta Description</span><span class="metric-value">' + (onPageData.metaDescription ? 'Present (' + onPageData.metaDescription.length + ' chars)' : 'Missing') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">H1 Tags</span><span class="metric-value">' + (onPageData.headings?.h1 || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">H2 Tags</span><span class="metric-value">' + (onPageData.headings?.h2 || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">H3 Tags</span><span class="metric-value">' + (onPageData.headings?.h3 || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Images without Alt</span><span class="metric-value">' + (onPageData.images?.missingAlt || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Internal Links</span><span class="metric-value">' + (onPageData.links?.internal || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">External Links</span><span class="metric-value">' + (onPageData.links?.external || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Word Count</span><span class="metric-value">' + (onPageData.content?.wordCount || 0) + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Readability Score</span><span class="metric-value">' + (onPageData.content?.readabilityScore || 'N/A') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Language</span><span class="metric-value">' + (onPageData.technical?.language || 'Unknown') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">SSL Certificate</span><span class="metric-value">' + (onPageData.technical?.sslCertificate ? '✅ Secure' : '❌ Not Secure') + '</span></div>';
            
            // Add services section if available
            if (onPageData.content?.services && onPageData.content.services.length > 0) {
                html += '<div class="content-section"><h4>Services Found</h4><div class="services-list">';
                onPageData.content.services.forEach(service => {
                    html += '<span class="service-tag">' + service + '</span>';
                });
                html += '</div></div>';
            }
            
            // Add projects section if available
            if (onPageData.content?.projects && onPageData.content.projects.length > 0) {
                html += '<div class="content-section"><h4>Projects Found</h4><div class="projects-list">';
                onPageData.content.projects.slice(0, 3).forEach(project => {
                    html += '<div class="project-item">';
                    html += '<div class="project-name">' + project.name + '</div>';
                    if (project.description) {
                        html += '<div class="project-desc">' + project.description + '</div>';
                    }
                    html += '</div>';
                });
                html += '</div></div>';
            }
            
            // Add contact info if available
            if (onPageData.content?.contactInfo && (onPageData.content.contactInfo.phones.length > 0 || onPageData.content.contactInfo.emails.length > 0)) {
                html += '<div class="content-section"><h4>Contact Information</h4><div class="contact-info">';
                if (onPageData.content.contactInfo.phones.length > 0) {
                    html += '<div class="contact-item"><strong>Phone:</strong> ' + onPageData.content.contactInfo.phones.join(', ') + '</div>';
                }
                if (onPageData.content.contactInfo.emails.length > 0) {
                    html += '<div class="contact-item"><strong>Email:</strong> ' + onPageData.content.contactInfo.emails.join(', ') + '</div>';
                }
                html += '</div></div>';
            }
            
            // Add SEO Recommendations
            if (onPageData.recommendations) {
                html += '<div class="content-section"><h4>🔧 SEO Recommendations</h4>';
                
                // Critical Issues
                if (onPageData.recommendations.critical && onPageData.recommendations.critical.length > 0) {
                    html += '<div class="recommendations-section"><h5 class="critical-title">🚨 Critical Issues (' + onPageData.recommendations.critical.length + ')</h5>';
                    onPageData.recommendations.critical.forEach(rec => {
                        html += '<div class="recommendation-item critical">';
                        html += '<div class="rec-header"><strong>' + rec.issue + '</strong> <span class="impact-badge critical">' + rec.impact + '</span></div>';
                        html += '<div class="rec-recommendation">' + rec.recommendation + '</div>';
                        if (rec.example) {
                            html += '<div class="rec-example"><strong>Example:</strong> ' + rec.example + '</div>';
                        }
                        html += '<div class="rec-action"><strong>Action:</strong> ' + rec.action + '</div>';
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                // Important Issues
                if (onPageData.recommendations.important && onPageData.recommendations.important.length > 0) {
                    html += '<div class="recommendations-section"><h5 class="important-title">⚠️ Important Issues (' + onPageData.recommendations.important.length + ')</h5>';
                    onPageData.recommendations.important.forEach(rec => {
                        html += '<div class="recommendation-item important">';
                        html += '<div class="rec-header"><strong>' + rec.issue + '</strong> <span class="impact-badge important">' + rec.impact + '</span></div>';
                        html += '<div class="rec-recommendation">' + rec.recommendation + '</div>';
                        if (rec.current) {
                            html += '<div class="rec-current"><strong>Current:</strong> ' + rec.current + '</div>';
                        }
                        html += '<div class="rec-action"><strong>Action:</strong> ' + rec.action + '</div>';
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                // Suggestions
                if (onPageData.recommendations.suggestions && onPageData.recommendations.suggestions.length > 0) {
                    html += '<div class="recommendations-section"><h5 class="suggestions-title">💡 Suggestions (' + onPageData.recommendations.suggestions.length + ')</h5>';
                    onPageData.recommendations.suggestions.forEach(rec => {
                        html += '<div class="recommendation-item suggestion">';
                        html += '<div class="rec-header"><strong>' + rec.issue + '</strong> <span class="impact-badge suggestion">' + rec.impact + '</span></div>';
                        html += '<div class="rec-recommendation">' + rec.recommendation + '</div>';
                        html += '<div class="rec-action"><strong>Action:</strong> ' + rec.action + '</div>';
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            content.innerHTML = html;
        }

        function displayKeywordsAnalysis(keywordsData) {
            const content = document.getElementById('keywordsContent');
            
            if (!keywordsData) {
                content.innerHTML = '<div class="error">Keyword analysis data not available</div>';
                return;
            }

            // Handle upgrade required status
            if (keywordsData.status === 'requires_upgrade') {
                content.innerHTML = '<div class="upgrade-notice">' + keywordsData.message + '<br><small>This feature requires DataForSEO Labs subscription</small></div>';
                return;
            }

            // Handle successful analysis from Boostramp or other sources
            if (keywordsData.status === 'success') {
                let html = '<div class="success-notice">✅ ' + keywordsData.message + '</div>';
                html += '<div class="metric-item"><span class="metric-label">Total Keywords</span><span class="metric-value">' + (keywordsData.totalKeywords || 0) + '</span></div>';
                html += '<div class="metric-item"><span class="metric-label">Top Keywords</span><span class="metric-value">' + (keywordsData.topKeywords?.length || 0) + '</span></div>';
                html += '<div class="metric-item"><span class="metric-label">Search Volume</span><span class="metric-value">' + (keywordsData.searchVolume || 'N/A') + '</span></div>';
                
                // Show extracted keywords if available
                if (keywordsData.extractedKeywords && keywordsData.extractedKeywords.length > 0) {
                    html += '<div class="content-section"><h4>Extracted Keywords</h4><div class="keywords-list">';
                    keywordsData.extractedKeywords.slice(0, 10).forEach(keyword => {
                        html += '<span class="keyword-tag">' + keyword + '</span>';
                    });
                    html += '</div></div>';
                }
                
                content.innerHTML = html;
                return;
            }

            if (!keywordsData.keywords || keywordsData.keywords.length === 0) {
                content.innerHTML = '<div class="error">No keyword data available</div>';
                return;
            }

            const topKeywords = keywordsData.keywords.slice(0, 6);
            let html = '<div class="keyword-list">';
            
            topKeywords.forEach(keyword => {
                html += `
                    <div class="keyword-item">
                        <div class="keyword-text">${keyword.keyword}</div>
                        <div class="keyword-stats">
                            Position: ${keyword.position} | Volume: ${keyword.searchVolume} | CPC: $${keyword.cpc}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function displayCompetitorsAnalysis(competitorsData) {
            const content = document.getElementById('competitorsContent');
            
            if (!competitorsData) {
                content.innerHTML = '<div class="upgrade-notice">🔒 Competitor analysis not available in sandbox mode<br><small>This feature requires DataForSEO Labs subscription for production use</small></div>';
                return;
            }

            // Handle upgrade required status
            if (competitorsData.status === 'requires_upgrade') {
                content.innerHTML = '<div class="upgrade-notice">' + competitorsData.message + '<br><small>This feature requires DataForSEO Labs subscription</small></div>';
                return;
            }

            // Handle successful AI analysis
            if (competitorsData.status === 'success') {
                let html = '<div class="success-notice">✅ ' + competitorsData.message + '</div>';
                html += '<div class="metric-item"><span class="metric-label">Total Competitors</span><span class="metric-value">' + (competitorsData.totalCompetitors || 0) + '</span></div>';
                html += '<div class="metric-item"><span class="metric-label">Analysis Method</span><span class="metric-value">' + (competitorsData.analysisMethod || 'AI-powered insights') + '</span></div>';
                
                // Show competitors if available
                if (competitorsData.competitors && competitorsData.competitors.length > 0) {
                    html += '<div class="content-section"><h4>Identified Competitors</h4><div class="competitors-list">';
                    competitorsData.competitors.slice(0, 5).forEach(competitor => {
                        html += '<div class="competitor-item">';
                        html += '<div class="competitor-name">' + (competitor.name || 'Unknown') + '</div>';
                        html += '<div class="competitor-desc">' + (competitor.description || 'No description available') + '</div>';
                        html += '<div class="competitor-position">' + (competitor.position || 'Market position unknown') + '</div>';
                        html += '</div>';
                    });
                    html += '</div></div>';
                }
                
                content.innerHTML = html;
                return;
            }

            if (!competitorsData.competitors || competitorsData.competitors.length === 0) {
                content.innerHTML = '<div class="upgrade-notice">🔒 No competitor data available in sandbox mode<br><small>Competitor analysis requires DataForSEO Labs subscription</small></div>';
                return;
            }

            const topCompetitors = competitorsData.competitors.slice(0, 4);
            let html = '<div class="competitor-list">';
            
            topCompetitors.forEach(competitor => {
                html += `
                    <div class="competitor-item">
                        <div class="competitor-domain">${competitor.domain}</div>
                        <div class="competitor-stats">
                            <div class="stat-item">
                                <div class="stat-label">Shared Keywords</div>
                                <div class="stat-value">${competitor.commonKeywords}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Domain Rating</div>
                                <div class="stat-value">${competitor.domainRating}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Organic Traffic</div>
                                <div class="stat-value">${competitor.organicTraffic}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Domain Rank</div>
                                <div class="stat-value">${competitor.domainRank}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function displayBacklinksAnalysis(backlinksData) {
            const content = document.getElementById('backlinksContent');
            
            if (!backlinksData) {
                content.innerHTML = '<div class="upgrade-notice">🔒 Backlink analysis not available in sandbox mode<br><small>This feature requires DataForSEO Labs subscription for production use</small></div>';
                return;
            }

            // Handle upgrade required status
            if (backlinksData.status === 'requires_upgrade') {
                content.innerHTML = '<div class="upgrade-notice">' + backlinksData.message + '<br><small>This feature requires DataForSEO Labs subscription</small></div>';
                return;
            }

            let html = '<div class="metric-item"><span class="metric-label">Total Backlinks</span><span class="metric-value">' + (backlinksData.totalBacklinks || 'N/A') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Referring Domains</span><span class="metric-value">' + (backlinksData.referringDomains || 'N/A') + '</span></div>';
            html += '<div class="metric-item"><span class="metric-label">Domain Authority</span><span class="metric-value">' + (backlinksData.domainAuthority || 'N/A') + '</span></div>';
            
            content.innerHTML = html;
        }

        function toggleAIRecommendations(section) {
            const aiDiv = document.getElementById(section + 'AI');
            const isVisible = aiDiv.classList.contains('show');
            
            if (isVisible) {
                aiDiv.classList.remove('show');
            } else {
                aiDiv.classList.add('show');
                if (!aiDiv.dataset.loaded) {
                    loadAIRecommendations(section);
                }
            }
        }

        async function loadAIRecommendations(section) {
            if (!currentAnalysis) {
                showError('No analysis data available');
                return;
            }

            const aiDiv = document.getElementById(section + 'AI');
            const loadingDiv = aiDiv.querySelector('.ai-loading');
            
            try {
                // Show loading state
                loadingDiv.innerHTML = '🤖 AI is analyzing your ' + section + ' SEO...';
                
                const response = await fetch('/api/dataforseo/ai-recommendations-enhanced', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        url: currentAnalysis.url,
                        onPageData: currentAnalysis.onPage,
                        keywordsData: currentAnalysis.keywords,
                        competitorsData: currentAnalysis.competitors
                    })
                });

                const result = await response.json();
                
                if (result.success && result.recommendations) {
                    // Display AI recommendations
                    let html = '<div class="ai-recommendations-content">';
                    html += '<h4>🤖 AI-Powered SEO Recommendations</h4>';
                    
                    result.recommendations.forEach(rec => {
                        html += '<div class="ai-recommendation-item">';
                        html += '<div class="ai-rec-header">';
                        html += '<strong>' + rec.issue + '</strong>';
                        html += '<span class="ai-impact-badge ' + rec.impact.toLowerCase() + '">' + rec.impact + '</span>';
                        html += '</div>';
                        html += '<div class="ai-rec-text">' + rec.recommendation + '</div>';
                        html += '<div class="ai-rec-action"><strong>Action:</strong> ' + rec.action + '</div>';
                        if (rec.example) {
                            html += '<div class="ai-rec-example"><strong>Example:</strong> ' + rec.example + '</div>';
                        }
                        html += '</div>';
                    });
                    
                    html += '</div>';
                    loadingDiv.innerHTML = html;
                    aiDiv.dataset.loaded = 'true';
                } else {
                    loadingDiv.innerHTML = '❌ Failed to load AI recommendations. Please try again.';
                }
            } catch (error) {
                console.error('AI recommendations error:', error);
                loadingDiv.innerHTML = '❌ Error loading AI recommendations. Please try again.';
            }
        }

        function getSectionData(section, analysis) {
            switch (section) {
                case 'onpage':
                    return analysis.onPage;
                case 'keywords':
                    return analysis.keywords;
                case 'competitors':
                    return analysis.competitors;
                case 'backlinks':
                    return analysis.backlinks;
                default:
                    return {};
            }
        }

        function getScoreClass(score) {
            if (score >= 80) return 'score-excellent';
            if (score >= 60) return 'score-good';
            return 'score-poor';
        }

        function getScoreDescription(score) {
            if (score >= 80) return 'Excellent SEO performance';
            if (score >= 60) return 'Good SEO performance';
            if (score >= 40) return 'Needs improvement';
            return 'Poor SEO performance';
        }

        function showError(message) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `<div class="error">${message}</div>`;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
